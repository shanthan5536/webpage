a<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Campus Materials Exchange</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #f0f6ff; margin: 0; color: #222;
      transition: background 0.30s, color 0.30s;
    }
    .dark-theme body { background: #232946; color: #ececec; }
    .container {
      max-width: 1200px;
      margin:48px auto 0;
      background: #fff;
      box-shadow: 0 5px 32px #3e79c640;
      border-radius: 18px;
    }
    .dark-theme .container { background: #232946; box-shadow: 0 5px 36px #22283b;}
    .section {padding:48px 44px 36px; border-radius: 12px;}
    .hidden {display:none;}
    .header {
      background: #2563eb; color:#fff; border-radius:18px 18px 0 0; padding:40px 44px 24px;
      transition: background 0.3s;
    }
    .dark-theme .header { background: #181c2a; color: #f2f3ff; }
    .header h1 {margin: 0 0 7px 0; font-size:2.5rem;}
    .action-btn, .primary-btn {
      background: linear-gradient(90deg, #6be6d8 0%, #098eff 88%); color: #fff;
      border: none; cursor: pointer; font-weight: 600;
      padding: 12px 26px; border-radius: 10px; font-size:1rem; margin-right: 13px; margin-bottom:10px;
      transition: background 0.25s, box-shadow 0.3s;
      box-shadow: 0 2px 9px #d3e4fb78;
    }
    .action-btn:hover, .primary-btn:hover {background: linear-gradient(100deg, #13a8fe 0%, #64e2bc 100%);}
    .dark-theme .action-btn, .dark-theme .primary-btn {background: linear-gradient(90deg,#363be5 0%,#434ecf 100%);color:#fff;}
    .dark-theme .action-btn:hover, .dark-theme .primary-btn:hover {background: linear-gradient(90deg,#5f7cff 0%,#18e6e6 93%);}
    .stat-row {display:flex;justify-content:center;gap:40px;margin-bottom:26px;flex-wrap:wrap;}
    .stat-card {
      background: linear-gradient(120deg, #ffecc4 0%, #eddafc 100%);
      border-radius:14px; box-shadow:0 1px 9px #71d1fd30;
      padding:22px 20px 18px 27px;
      width:250px; min-width:210px; margin:0 0 18px 0; text-align:left;
      transition: transform 0.2s;
      display:inline-block;
    }
    .dark-theme .stat-card {background: linear-gradient(120deg, #3a334d 0%, #28445e 100%); color: #f4e7f6;}
    .stat-card:hover {transform:translateY(-2px) scale(1.02);}
    .stat-label {color: #5b4d96; font-size:16px;}
    .stat-value {font-size: 2.3rem; font-weight:800; margin-bottom:4px; color:#2247b7;}
    .dark-theme .stat-label {color:#bdb5e9;}
    .dark-theme .stat-value {color:#aae2ff;}
    .main-actions-bar {
      display:flex;
      align-items:center;
      gap:18px;
      margin:0 0 12px 0;
      justify-content:flex-end;
      flex-wrap:wrap;
    }
    .main-actions-bar .primary-btn, .main-actions-bar .theme-toggle, .main-actions-bar #profileBtn {
      margin-top:0; margin-bottom:0;
    }
    .main-actions-bar .primary-btn {min-width:150px;}
    .main-actions-bar #profileBtn {margin:0;}
    .main-actions-bar .theme-toggle {margin-left:0;}
    .main-actions-bar #filterBtn {min-width:100px;}
    .filters-bar {
      background: linear-gradient(94deg, #e8f6ff 0%, #fef6eb 100%);
      border-radius:11px; padding: 22px 26px; box-shadow:0 1px 9px #e0efed80; margin-bottom:30px;
      display:flex;justify-content:center;
    }
    .dark-theme .filters-bar {background:linear-gradient(92deg,#263e62 0%,#362d43 100%);}
    .filters-row label {color:#0773ba; margin-right:5px; font-weight:500;}
    .dark-theme .filters-row label {color:#a3f0fc;}
    .filters-row select, .filters-row input {margin:0 14px 0 0; border-radius:7px; border:1.4px solid #cce2fe; padding:10px 20px; font-size:1.09em;}
    .dark-theme .filters-row select, .dark-theme .filters-row input {border:1.2px solid #525c90;background: #222634;color:#f7f7f7;}
    .resource-card {
      background: linear-gradient(97deg,#fff 65%, #f7feff 100%);
      border-radius:16px; box-shadow:0 2px 10px #95caef20;
      padding:29px 36px 20px; margin-bottom:26px; transition: border 0.24s, transform 0.21s;
      border-left:7px solid #1ad8ea77;
      font-size:1.07em;
      max-width:820px;
      margin-left:auto; margin-right:auto;
    }
    .resource-card:hover {border-left:7px solid #236fdc; transform:scale(1.012);}
    .dark-theme .resource-card {background:linear-gradient(95deg,#1d1f2a 65%, #2c3c4a 100%); color:#e3efff; border-left:7px solid #33aafc;}
    .badge {display:inline-block; background:#baffed; color:#1678ba; border-radius:13px; font-size:13px; padding:4px 17px; margin:2px 12px 2px 0;}
    .dark-theme .badge {background:#253161; color:#83f6e4;}
    .footer {text-align:center; color: #7a8aa3; margin:0; padding:27px 14px 18px;}
    .dark-theme .footer {color: #96a9bb;}
    .dropzone {
      margin:20px 0 17px 0; padding:42px 0; border:2.4px dashed #b1d3fc; border-radius:14px;
      text-align:center; background: #fafdff;
      color:#27a3c2;font-size:1.1em;cursor:pointer;transition: background 0.18s;
    }
    .dropzone.dragover {background:#e7f9f6;}
    .dark-theme .dropzone {background:#273446; border:2.4px dashed #39e7e3; color:#2fc4df;}
    .modal {
      display:none; position:fixed; z-index:1002;left:0; top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.45);
    }
    .modal-content {background:#fff; border-radius:18px; max-width:680px; width:98vw; margin:76px auto 0; box-shadow:0 10px 48px #232e6275; padding:42px 32px 30px; position:relative;}
    .dark-theme .modal-content {background:#121830; color:#d4e5ef;}
    .modal-close {position: absolute; top: 22px; right: 19px; background: none; border:none; color:#888; font-size: 1.5rem; cursor:pointer;}
    .goback-btn {background:linear-gradient(90deg,#ffffff,#e1f3fd); color:#2563eb; border:2px solid #bbdfff;border-radius:8px;padding:10px 34px;margin-bottom:23px;cursor:pointer;font-weight:600;}
    .goback-btn:hover {background:#add7f8; color:#0d2454;}
    .dark-theme .goback-btn {background: linear-gradient(90deg,#1a2048,#374867); color:#42c6f8; border:2px solid #3efef6;}
    .theme-toggle {
      float:right;
      background: linear-gradient(135deg, #0c378c 20%, #08dacf 88%);
      color: #fff;
      border: none;
      border-radius: 50%;
      width: 50px; height: 50px;
      font-size: 1.5em;
      font-weight: 600;
      box-shadow:0 2px 12px #0db5fa17;
      cursor:pointer;
      display: flex; align-items: center; justify-content: center;
      transition: background 0.27s, color 0.27s, box-shadow 0.25s;
      margin: 0 0 0 15px;
    }
    .theme-toggle:hover {
      background:linear-gradient(135deg,#0ab4d9 10%,#50d96a 100%);
    }
    .dark-theme .theme-toggle {
      background:linear-gradient(135deg,#f8de40 10%,#ffe3a1 100%);
      color: #2a2545;
    }
    .dark-theme .theme-toggle:hover {
      background:linear-gradient(135deg,#fff8c0 20%,#c1ecac 100%);
    }
    @media (max-width:1400px){.container{max-width: 98vw;} .main-actions-bar {justify-content: flex-end;} .stat-row{gap:20px;}}
    @media (max-width:950px){ .section, .header{padding-left:5vw; padding-right:5vw;} .stat-row, .filters-bar {flex-direction:column;} .main-actions-bar {justify-content: flex-start;}}
    @media (max-width:680px){ .section, .header{padding:16px !important;} .stat-card{width:92vw;} .filters-row label {display:block;margin-bottom:8px;} .filters-bar{padding:10px;} .main-actions-bar{gap:6px;} .resource-card{padding: 17px 5vw 12px;}}
    #filterModal .modal-content form label {font-weight:500;margin-bottom:4px;display:block;}
    #filterModal .modal-content input, #filterModal .modal-content select {margin-bottom:18px;padding:11px 18px;border-radius:8px;width:97%;font-size:1.06em;}
    #filterModal .modal-content input:focus, #filterModal .modal-content select:focus {outline:1.5px solid #98cdf7;}
  </style>
</head>
<body>
<div class="container">

  <div class="header" id="welcomePage">
    <h1>Campus Materials Exchange</h1>
    <p>Share and discover academic resources.<br><span style="font-size:0.98em;">Admin: <b>admin@site.com</b></span></p>
    <br>
    <input type="email" id="loginEmail" placeholder="Email" style="padding:12px 18px; width:290px; font-size:1.09em;" pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" required><br>
    <input type="password" id="loginPass" placeholder="Password" style="padding:12px 18px; width:290px; font-size:1.09em;">
    <br><button class="primary-btn" onclick="login()">Login</button>
    <div id="loginError" style="color:#d62d20;margin-top:5px;font-size:1em;"></div>
  </div>
  <div class="section hidden" id="profilePage">
    <button class="goback-btn" onclick="goBack()">Go Back</button>
    <h2 style="margin-top:0;">Profile</h2>
    <input type="text" id="profileName" placeholder="Full Name" style="padding:12px 18px;width:245px;">
    <select id="profileDept" style="padding:12px 18px;width:185px;">
      <option value="">Select Department</option>
      <option>Mechanical Engineering</option>
      <option>Automobile Engineering</option>
      <option>Computer Science Engineering</option>
      <option>Civil Engineering</option>
      <option>Electrical and Electronical Engineering</option>
      <option>Electrical and Communicational Engineering</option>
    </select>
    <select id="profileYear" style="padding:12px 18px;width:140px;">
      <option value="">Select Year</option>
      <option>1st year</option><option>2nd year</option><option>3rd year</option><option>4th year</option>
    </select>
    <br><button class="primary-btn" onclick="saveProfile()">Save Profile</button>
  </div>
  <div class="section hidden" id="mainPage">
    <div class="main-actions-bar">
      <button class="theme-toggle" id="themeBtn" onclick="toggleTheme()"><span id="themeIcon">üåô</span></button>
      <button class="primary-btn" id="profileBtn" onclick="showProfilePage()">üë§ Profile</button>
      <button class="primary-btn" onclick="showUploadPage()" style="margin-left:14px;">+ Upload Resource</button>
      <button style="background:#f59f51; color:#1e293b;font-weight:600;border-radius:8px;" onclick="logout()">Logout</button>
    </div>
    <h2 style="margin-bottom:0; text-align:center; font-size:2.1rem;">Browse & Search Materials</h2>
    <div class="stat-row">
      <div class="stat-card"><div class="stat-label">Total Resources</div><div class="stat-value" id="statResources">0</div></div>
      <div class="stat-card"><div class="stat-label">Total Views</div><div class="stat-value" id="statViews">0</div></div>
      <div class="stat-card"><div class="stat-label">Total Downloads</div><div class="stat-value" id="statDownloads">0</div></div>
    </div>
    <div id="adminPanel" class="hidden" style="margin:26px 0;">
      <button class="action-btn" onclick="showUsersModal()">üë• View All Users</button>
      <button class="action-btn" onclick="showFilesModal()">üìÅ View All Files</button>
    </div>
    <div class="filters-bar">
      <div class="filters-row" style="display:flex;flex-wrap:wrap;align-items:center;gap:10px;">
        <label style="display:flex;align-items:center;gap:0;">
          <input type="text" id="searchBar" style="width:190px;" placeholder="Search..." oninput="applyFilters()">
          <button title="Filter" id="filterBtn" onclick="openFilterModal()" style="background:transparent;border:none;cursor:pointer;font-size:1.5em;line-height:1;margin-left:8px;padding:6px;vertical-align:middle;">
            <span style="font-size:1.45em;vertical-align:middle;">üîç</span>
          </button>
        </label>
        <label>Year:
          <select id="filterYear" onchange="applyFilters()" style="margin-left:8px;">
            <option value="">All Years</option>
            <option>1st year</option>
            <option>2nd year</option>
            <option>3rd year</option>
            <option>4th year</option>
          </select>
        </label>
      </div>
    </div>
    <div id="resourcesContainer"></div>
    <div id="emptyState" style="display:none;text-align:center;color:#888;margin:60px 0 0;">
      <div style="font-size:44px;">üìö</div>
      <div>No resources yet. Be the first to upload!</div>
    </div>
  </div>
  <div id="filterModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="closeFilterModal()">√ó</button>
      <h2>Filter Resources</h2>
      <form id="filterForm" onsubmit="applyDialogFilters(event)">
        <div style="display:grid;grid-template-columns:1fr 1fr; gap:24px;">
          <div>
            <label>Course Code
              <input type="text" id="modalCourse" style="width:95%;">
            </label>
          </div>
          <div>
            <label>File Type
              <select id="modalFileType" style="width:95%;">
                <option value="">All Types</option>
                <option value="PDF">PDF</option>
                <option value="DOC">DOC</option>
                <option value="PPT">PPT</option>
              </select>
            </label>
          </div>
          <div>
            <label>Year
              <select id="modalYear" style="width:95%;">
                <option value="">All Years</option>
                <option>1st year</option>
                <option>2nd year</option>
                <option>3rd year</option>
                <option>4th year</option>
              </select>
            </label>
          </div>
          <div>
            <label>Department
              <select id="modalDept" style="width:95%;">
                <option value="">All Departments</option>
                <option>Mechanical Engineering</option>
                <option>Automobile Engineering</option>
                <option>Computer Science Engineering</option>
                <option>Civil Engineering</option>
                <option>Electrical and Electronical Engineering</option>
                <option>Electrical and Communicational Engineering</option>
              </select>
            </label>
          </div>
          <div>
            <label>Subject
              <select id="modalSubject" style="width:95%;">
                <option value="">All Major Subjects</option>
                <option>Mathematics</option>
                <option>Physics</option>
                <option>Chemistry</option>
                <option>Mechanics</option>
                <option>Thermodynamics</option>
                <option>Electrical Circuits</option>
                <option>Digital Electronics</option>
                <option>Computer Programming</option>
                <option>Fluid Mechanics</option>
                <option>Materials Science</option>
                <option>Signals and Systems</option>
                <option>Structural Analysis</option>
                <option>Control Systems</option>
              </select>
            </label>
          </div>
        </div>
        <div style="margin-top:28px;display:flex;gap:20px;justify-content:right;">
          <button type="button" class="goback-btn" onclick="closeFilterModal()" style="margin-bottom:0;">Cancel</button>
          <button type="submit" class="primary-btn" style="margin-bottom:0;">Apply Filters</button>
        </div>
      </form>
    </div>
  </div>
  <div class="section hidden" id="uploadPage">
    <h2>Upload a Resource</h2>
    <div id="fileDrop" class="dropzone" onclick="document.getElementById('upFileInput').click()">Drag &amp; drop a file here or click to select</div>
    <input type="file" id="upFileInput" style="display:none" onchange="handleFileInput(event)">
    <div id="fileChosen" style="margin-bottom:13px;color:#1d6ac9;"></div>
    <input type="text" id="upTitle" placeholder="Title"><br>
    <textarea id="upDesc" placeholder="Description..." rows="3" style="width:97%;margin-top:7px;"></textarea><br>
    <select id="upSubject" style="padding:10px 14px;width:220px;">
      <option value="">Select Major Subject</option>
      <option>Mathematics</option>
      <option>Physics</option>
      <option>Chemistry</option>
      <option>Mechanics</option>
      <option>Thermodynamics</option>
      <option>Electrical Circuits</option>
      <option>Digital Electronics</option>
      <option>Computer Programming</option>
      <option>Fluid Mechanics</option>
      <option>Materials Science</option>
      <option>Signals and Systems</option>
      <option>Structural Analysis</option>
      <option>Control Systems</option>
    </select>
    <select id="upDept" style="padding:10px 14px;width:185px;">
      <option value="">Select Department</option>
      <option>Mechanical Engineering</option>
      <option>Automobile Engineering</option>
      <option>Computer Science Engineering</option>
      <option>Civil Engineering</option>
      <option>Electrical and Electronical Engineering</option>
      <option>Electrical and Communicational Engineering</option>
    </select>
    <select id="upYear" style="padding:10px 14px;width:140px;">
      <option value="">Select Year</option>
      <option>1st year</option><option>2nd year</option><option>3rd year</option><option>4th year</option>
    </select>
    <input type="text" id="upCourse" placeholder="Course Code" style="width:110px;">
    <select id="upType"><option value="">Type</option><option>PDF</option><option>DOC</option><option>PPT</option></select><br>
    <br>
    <button class="primary-btn" onclick="uploadResource()">Upload</button>
    <button style="background:#eee;color:#111;padding:13px 28px;border-radius:10px;" onclick="goBack()">Cancel</button>
  </div>
  <div class="section hidden" id="viewPage">
    <button class="goback-btn" onclick="goBack()">Go Back</button>
    <h2>View Resource</h2>
    <div id="viewDetails"></div>
  </div>
  <div class="section hidden" id="downloadPage">
    <button class="goback-btn" onclick="goBack()">Go Back</button>
    <h2>Download Resource</h2>
    <div id="downloadDetails"></div>
  </div>
  <div id="usersModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="document.getElementById('usersModal').style.display='none'">√ó</button>
      <h2>All Users</h2>
      <div id="usersTable"></div>
    </div>
  </div>
  <div id="filesModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" onclick="document.getElementById('filesModal').style.display='none'">√ó</button>
      <h2>All Files & Uploaders</h2>
      <div id="filesTable"></div>
    </div>
  </div>
  <div class="footer">Campus Materials Exchange &copy; 2025 | Demo UI</div>
</div>
<script>
let user = null, resources = [], profile = {name:"", dept:"", year:""}, chosenFile = null, isAdmin = false;
let navigationStack = ['welcomePage'];
let activeDialogFilters = {};
function toggleTheme() {
  let theme = document.documentElement.classList.contains('dark-theme') ? 'light' : 'dark';
  setTheme(theme);
}
function setTheme(theme) {
  if(theme === 'dark') {
    document.documentElement.classList.add('dark-theme');
    document.getElementById('themeIcon').textContent="‚òÄÔ∏è";
  } else {
    document.documentElement.classList.remove('dark-theme');
    document.getElementById('themeIcon').textContent="üåô";
  }
}
setTheme('light');
function showProfilePage() { showPage('profilePage'); }
function openFilterModal() {
  document.getElementById('modalCourse').value = activeDialogFilters.courseCode || '';
  document.getElementById('modalFileType').value = activeDialogFilters.fileType || '';
  document.getElementById('modalYear').value = activeDialogFilters.year || '';
  document.getElementById('modalDept').value = activeDialogFilters.dept || '';
  document.getElementById('modalSubject').value = activeDialogFilters.subject || '';
  document.getElementById('filterModal').style.display = 'block';
}
function closeFilterModal() { document.getElementById('filterModal').style.display = 'none'; }
function applyDialogFilters(e) {
  e.preventDefault();
  activeDialogFilters = {
    courseCode: document.getElementById('modalCourse').value.trim().toLowerCase(),
    fileType: document.getElementById('modalFileType').value,
    year: document.getElementById('modalYear').value,
    dept: document.getElementById('modalDept').value,
    subject: document.getElementById('modalSubject').value
  };
  closeFilterModal();
  renderResources();
}
function showPage(id) {
  ['welcomePage', 'profilePage', 'mainPage', 'uploadPage', 'viewPage', 'downloadPage'].forEach(p =>
    document.getElementById(p).classList.add('hidden')
  );
  document.getElementById(id).classList.remove('hidden');
  if(navigationStack[navigationStack.length-1] !== id) navigationStack.push(id);
  if (id==="mainPage") renderResources();
}
function goBack() {
  if (navigationStack.length > 1) navigationStack.pop();
  let prev = navigationStack[navigationStack.length-1] || 'mainPage';
  showPage(prev);
}
showPage('welcomePage');
function login() {
  let emailEl = document.getElementById('loginEmail');
  let email = emailEl.value.trim().toLowerCase();
  let error = "";
  let validPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
  if (!validPattern.test(email)) {
    error = "Please enter a valid email address.";
    document.getElementById('loginError').innerText = error;
    emailEl.focus();
    return;
  }
  user = email;
  isAdmin = (user === 'admin@site.com');
  document.getElementById('loginError').innerText = ""; // Clear error
  showPage('profilePage');
}
function saveProfile() {
  profile.name = document.getElementById('profileName').value || user;
  profile.dept = document.getElementById('profileDept').value;
  profile.year = document.getElementById('profileYear').value;
  showPage('mainPage');
  renderStats();
  renderResources();
  document.getElementById('adminPanel').classList.toggle('hidden',!isAdmin);
}
function logout() {user = null; isAdmin = false; navigationStack=['welcomePage']; showPage('welcomePage');}
const dropzone = document.getElementById('fileDrop');
dropzone.addEventListener('dragover', function(e){
  e.preventDefault(); dropzone.classList.add('dragover');
});
dropzone.addEventListener('dragleave', function(e){
  e.preventDefault(); dropzone.classList.remove('dragover');
});
dropzone.addEventListener('drop', function(e){
  e.preventDefault(); dropzone.classList.remove('dragover');
  let fl = e.dataTransfer.files[0];
  handleSelectedFile(fl);
});
function handleFileInput(e) {
  let fl = e.target.files[0];
  handleSelectedFile(fl);
}
function handleSelectedFile(file) {
  if (!file) return;
  chosenFile = file;
  document.getElementById('fileChosen').innerText = "Selected: " + file.name + " (" + file.type + ")";
}
function renderStats() {
  document.getElementById('statResources').innerText = resources.length;
  document.getElementById('statViews').innerText = resources.reduce((a,b)=>a+(b.views||0),0);
  document.getElementById('statDownloads').innerText = resources.reduce((a,b)=>a+(b.downloads||0),0);
}
function applyFilters() {
  let kw = document.getElementById('searchBar').value.toLowerCase();
  let yr = document.getElementById('filterYear').value;
  if (activeDialogFilters && JSON.stringify(activeDialogFilters) !== '{}') {
    activeDialogFilters = {};
  }
  let r = resources.filter(res => 
    (!kw || res.title.toLowerCase().includes(kw) || (res.tags||"").toLowerCase().includes(kw) ||
      (res.subject||"").toLowerCase().includes(kw) || (res.dept||"").toLowerCase().includes(kw) ||
      (res.year||"").toLowerCase().includes(kw) || (res.course||"").toLowerCase().includes(kw)) &&
    (!yr || res.year === yr)
  );
  renderResources(r);
}
function renderResources(list=null) {
  let r = (list!==null)?list:resources;
  renderStats();
  if (activeDialogFilters 
      && (activeDialogFilters.courseCode || activeDialogFilters.fileType || activeDialogFilters.year || activeDialogFilters.dept || activeDialogFilters.subject)) {
    r = r.filter(res =>
      (!activeDialogFilters.courseCode || (res.course || '').toLowerCase().includes(activeDialogFilters.courseCode)) &&
      (!activeDialogFilters.fileType || res.type === activeDialogFilters.fileType) &&
      (!activeDialogFilters.year || res.year === activeDialogFilters.year) &&
      (!activeDialogFilters.dept || (res.dept || '') === activeDialogFilters.dept) &&
      (!activeDialogFilters.subject || (res.subject || '') === activeDialogFilters.subject)
    );
  }
  let root = document.getElementById('resourcesContainer');
  root.innerHTML = "";
  document.getElementById('emptyState').style.display = (!r.length ? "block" : "none");
  r.forEach((res,i)=>{
    root.innerHTML += `<div class="resource-card">
      <b>${res.title}</b>
      <div>${res.subject?`<span class="badge">${res.subject}</span>`:""}
        ${res.dept?`<span class="badge">${res.dept}</span>`:""}
        ${res.year?`<span class="badge">${res.year}</span>`:""}
        ${res.course?`<span class="badge">${res.course}</span>`:""}
        ${res.type?`<span class="badge">${res.type}</span>`:""}
      </div>
      <div><span style="color:#888;font-size:13px;">Uploaded by <b>${res.uploader}</b></span></div>
      <div style="margin:11px 0;">${res.tags?(res.tags.split(',').map(tag=>`<span class="badge">${tag.trim()}</span>`).join('')):""}</div>
      <div><span style="color:#1c7a2c;">üëÅ ${res.views||0}</span> &nbsp;&nbsp;<span style="color:#eab308;">‚¨áÔ∏è ${res.downloads||0}</span></div>
      <button class="action-btn" onclick="viewResourcePage(${i})">View</button>
      <button class="action-btn" onclick="downloadResourcePage(${i})">Download</button>
    </div>`;
  });
}
function showUploadPage() {
  chosenFile = null; document.getElementById('fileChosen').innerText = "";
  ['upTitle','upDesc','upCourse','upType'].forEach(id=>document.getElementById(id).value="");
  document.getElementById('upYear').selectedIndex = 0;
  document.getElementById('upDept').selectedIndex = 0;
  document.getElementById('upSubject').selectedIndex = 0;
  showPage('uploadPage');
}
function uploadResource() {
  if (!chosenFile) { alert('Please select a file to upload.'); return; }
  let r = {
    title: document.getElementById('upTitle').value,
    description: document.getElementById('upDesc').value,
    subject: document.getElementById('upSubject').value,
    dept: document.getElementById('upDept').value,
    year: document.getElementById('upYear').value,
    course: document.getElementById('upCourse').value,
    type: document.getElementById('upType').value,
    uploader: profile.name||user,
    file: chosenFile, // File object!
    views:0,
    downloads:0
  };
  resources.push(r);
  chosenFile = null;
  showPage('mainPage'); renderResources();
}
function viewResourcePage(i) {
  let res = resources[i]; res.views = (res.views||0)+1; renderStats();
  let c = `<h3>${res.title}</h3>
    <div>${res.subject?`<span class="badge">${res.subject}</span>`:""}
        ${res.dept?`<span class="badge">${res.dept}</span>`:""}
        ${res.year?`<span class="badge">${res.year}</span>`:""}
        ${res.course?`<span class="badge">${res.course}</span>`:""}
        ${res.type?`<span class="badge">${res.type}</span>`:""}
    </div>
    <div style="margin:14px 0;"><b>Uploader:</b> ${res.uploader}</div>
    <div style="margin:7px 0;"><b>Description:</b> ${res.description||""}</div>
    <div><b>File Name:</b> ${res.file ? res.file.name : "--"} | <b>Type:</b> ${res.file ? res.file.type : "--"}</div>
    <button class="primary-btn" onclick="downloadResourcePage(${i})">Go to Download Page</button>
  `;
  document.getElementById('viewDetails').innerHTML = c;
  showPage('viewPage');
}
function downloadResourcePage(i) {
  let res = resources[i]; res.downloads = (res.downloads||0)+1; renderStats();
  let dURL = "";
  if (res.file) {
    dURL = URL.createObjectURL(res.file);
  }
  let c = `<h3>${res.title}</h3>
    <div><b>File type:</b> ${res.type||res.file?.type||""}</div>
    <div style="margin:12px 0"><b>Uploaded by:</b> ${res.uploader}</div>
    <div><b>Download Link:</b> ${
      dURL ? `<a href="${dURL}" download="${res.file.name}">${res.file.name}</a>` : "<i>No file selected</i>"
    }</div>
    <div style="margin-top:16px;font-size:0.99em;"><span>Downloads so far: <b>${res.downloads}</b></span></div>
  `;
  document.getElementById('downloadDetails').innerHTML = c;
  showPage('downloadPage');
}
function showUsersModal() {
  let users = [...new Set(resources.map(r=>r.uploader))];
  let t = `<table border=1 cellpadding=7 style="width:95%;margin-top:10px;"><tr style="background:#e5e7eb;"><th>User Name</th></tr>`;
  users.forEach(u=>{t+=`<tr><td>${u}</td></tr>`});
  t+="</table>";
  document.getElementById('usersTable').innerHTML=t; document.getElementById('usersModal').style.display='block';
}
function showFilesModal() {
  let t = `<table border=1 cellpadding=7 style="width:99%;margin-top:10px;"><tr style="background:#e5e7eb;">
  <th>Title</th><th>Subject</th><th>Dept</th><th>Year</th><th>Course</th><th>Type</th><th>Uploader</th></tr>`;
  resources.forEach(r=>{
    t += `<tr>
      <td>${r.title}</td>
      <td>${r.subject||""}</td>
      <td>${r.dept||""}</td>
      <td>${r.year||""}</td>
      <td>${r.course||""}</td>
      <td>${r.type||""}</td>
      <td>${r.uploader||""}</td>
    </tr>`;
  });
  t+="</table>";
  document.getElementById('filesTable').innerHTML = t; document.getElementById('filesModal').style.display='block';
}
</script>
</body>
</html>
